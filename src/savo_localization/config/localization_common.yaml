# Robot Savo â€” savo_localization/config/localization_common.yaml
# --------------------------------------------------------------
# ROS 2 PARAMS FILE (valid for --params-file)
#
# This file can be used by:
# - wheel_odom_node (C++)
# - imu_node (Python)
# - wheel_odom_fallback_node (Python)
# - localization_bringup.launch.py
#
# IMPORTANT:
# ROS2 parameter files MUST be node-scoped:
#   <node_name>:
#     ros__parameters:
#       ...
#
# We keep the original intent of your "localization_common" values,
# but map them into each node's parameters.

wheel_odom_node:
  ros__parameters:
    # -------------------------
    # Timing / health
    # -------------------------
    use_sim_time: false
    publish_hz: 50.0
    poll_hz: 2000.0
    debounce_us: 300

    # Optional: set gpiochip index. -1 = autodetect (recommended)
    gpiochip: -1

    # -------------------------
    # Encoder GPIO pins (BCM)
    # -------------------------
    left_a: 21
    left_b: 20
    right_a: 12
    right_b: 26

    # Sign conventions (make forward positive)
    invert_left: true
    invert_right: true

    # -------------------------
    # Wheel odom geometry / scaling
    # -------------------------
    wheel_dia_m: 0.065
    track_m: 0.165

    cpr: 20
    decoding: 4
    gear: 1.0

    # Optional clamps (not enforced in current C++ code, kept for future)
    max_wheel_speed_mps: 2.0
    max_yaw_rate_rps: 6.0

    # -------------------------
    # Frames
    # -------------------------
    frame_odom: "odom"
    frame_base: "base_link"

    # -------------------------
    # Covariances (conservative)
    # vy is unknown with rear-only encoders -> keep Y and Vy large
    # -------------------------
    cov_x: 0.02
    cov_y: 0.50
    cov_yaw: 0.05
    cov_vx: 0.05
    cov_vy: 1.00
    cov_wz: 0.05


imu_node:
  ros__parameters:
    # -------------------------
    # Timing / health
    # -------------------------
    use_sim_time: false
    rate_hz: 50.0
    stale_timeout_s: 0.30

    # dt clamp (used by Python utils_time if node applies it)
    dt_min_s: 0.0001
    dt_max_s: 0.50
    dt_fallback_s: 0.02

    # -------------------------
    # IMU (BNO055)
    # -------------------------
    i2c_address: 0x28
    invert_yaw: false
    invert_gyro_z: false

    # Frame
    frame_id: "imu_link"

    # Covariance defaults (start conservative)
    orientation_var: 2.5e-2
    angular_velocity_var: 5.0e-2
    linear_acceleration_var: 1.0e-1


wheel_odom_fallback_node:
  ros__parameters:
    # -------------------------
    # Timing / health
    # -------------------------
    use_sim_time: false
    publish_hz: 50.0
    stale_timeout_s: 0.30

    # dt clamp
    dt_min_s: 0.0001
    dt_max_s: 0.50
    dt_fallback_s: 0.02

    # -------------------------
    # Encoder GPIO pins (BCM)
    # -------------------------
    left_a: 21
    left_b: 20
    right_a: 12
    right_b: 26

    invert_left: true
    invert_right: true

    # -------------------------
    # Wheel geometry / scaling
    # -------------------------
    wheel_dia_m: 0.065
    track_m: 0.165

    cpr: 20
    decoding: 4
    gear: 1.0

    # Frames
    frame_odom: "odom"
    frame_base: "base_link"

    # Covariances (match C++ defaults)
    cov_x: 0.02
    cov_y: 0.50
    cov_yaw: 0.05
    cov_vx: 0.05
    cov_vy: 1.00
    cov_wz: 0.05