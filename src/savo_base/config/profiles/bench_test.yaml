# File: savo_base/config/profiles/bench_test.yaml
#
# Robot SAVO â€” Bench Test Profile (savo_base / base_driver_node)
# --------------------------------------------------------------
# Purpose:
#   Safe bench / desk testing profile for base-driver integration.
#   Use this before floor-driving to validate:
#     - watchdog timeout behavior
#     - safety stop + slowdown integration
#     - motor board communication
#     - wheel direction / sign conventions
#     - PWM scaling (with low-risk output cap)
#
# Notes:
#   - Parameters match the current `savo_base/nodes/base_driver_node.py` contract.
#   - This profile is intentionally conservative.
#   - For first power-on, keep robot lifted or use dryrun:=true.
#
# Typical usage (layered):
#   ros2 run savo_base base_driver_node --ros-args \
#     --params-file <path>/config/topics.yaml \
#     --params-file <path>/config/safety_timeouts.yaml \
#     --params-file <path>/config/motor_board_freenove.yaml \
#     --params-file <path>/config/mecanum_kinematics.yaml \
#     --params-file <path>/config/profiles/bench_test.yaml

/base_driver_node:
  ros__parameters:

    # -------------------------------------------------------------------------
    # Topics (aligned with Robot Savo locked stack)
    # -------------------------------------------------------------------------
    cmd_topic: "/cmd_vel_safe"
    safety_stop_topic: "/safety/stop"
    slowdown_topic: "/safety/slowdown_factor"
    watchdog_state_topic: "/savo_base/watchdog_state"
    base_state_topic: "/savo_base/base_state"

    # -------------------------------------------------------------------------
    # Safety integrations
    # -------------------------------------------------------------------------
    use_safety_stop: true
    use_slowdown_factor: true

    # slowdown_factor clamp (expected input range 0.0 .. 1.0)
    slowdown_default: 1.0
    slowdown_min: 0.0
    slowdown_max: 1.0

    # -------------------------------------------------------------------------
    # Control loop / watchdog / status publishing
    # -------------------------------------------------------------------------
    # Lower loop rate is sufficient for bench tests and easier to observe.
    loop_hz: 20.0

    # Tight watchdog so stale commands stop the robot quickly during testing.
    watchdog_timeout_s: 0.25

    # Human-readable status cadence for terminal dashboards/logging.
    publish_status_hz: 2.0

    # -------------------------------------------------------------------------
    # Command-space limits (Twist clamp before mecanum mixing)
    # These are normalized execution-domain limits used by base_driver_node.
    # -------------------------------------------------------------------------
    vx_limit: 0.35
    vy_limit: 0.30
    wz_limit: 0.30

    # -------------------------------------------------------------------------
    # Motor output scaling
    # PCA9685 raw full-scale is 4095. Keep bench cap conservative.
    # -------------------------------------------------------------------------
    max_duty: 1200
    turn_gain: 1.0

    # -------------------------------------------------------------------------
    # Robot Savo proven command convention signs
    # (matches your locked teleop/base defaults)
    # -------------------------------------------------------------------------
    forward_sign: -1
    strafe_sign: 1
    rotate_sign: 1

    # -------------------------------------------------------------------------
    # Board backend selection
    # -------------------------------------------------------------------------
    # "auto" -> use real backend if available
    # "dryrun" or dryrun=true -> safe no-hardware execution
    board_backend: "auto"
    board_name: "robot_savo_freenove_mecanum"
    dryrun: false

    # -------------------------------------------------------------------------
    # Freenove / PCA9685 hardware settings (Robot Savo locked defaults)
    # -------------------------------------------------------------------------
    i2c_bus: 1
    pca9685_addr: "0x40"
    pwm_freq_hz: 50.0
    quench_ms: 18

    # -------------------------------------------------------------------------
    # Per-wheel inversion flags
    # Keep false unless wheel_direction_check proves a wheel needs inversion.
    # Wheel order: FL, RL, FR, RR
    # -------------------------------------------------------------------------
    invert_fl: false
    invert_rl: false
    invert_fr: false
    invert_rr: false